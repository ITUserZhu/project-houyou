$(function(){$("img.lazy").lazyload({effect:"fadeIn",threshold:500}),$(".footer-info").find("a").click(function(){$("#login-box").show()});var e=$("#index-search-btn"),t=$("#index-search-ipt");e.on("click",function(e){var i=t.val();__commSearchReg(i)}),t.on("keydown",function(e){var i=e||window.event||arguments.callee.caller.arguments[0],a=t.val();i&&13==i.keyCode&&__commSearchReg(a)});var o=[];window.sessionStorage.colItem&&(o=window.sessionStorage.colItem.split(","));var l=$("#index-fix-nav");$(window).on("scroll",function(){var e=$(document).scrollTop(),i=$(".fl-aside").offset().top-60,a=$(".sidebar-wrapper");i<=e?(a.show(),l.fadeIn(),$(".fl-aside aside").addClass("float")):(a.hide(),l.fadeOut(),$(".fl-aside aside").removeClass("float"))});var a,n=$(".banner-container").children(".banner-item"),s=$(".banner-btn").children("li"),c=0;a=setInterval(function(){c=c<n.length-1?++c:0,n.each(function(e,i){e==c&&($(i).fadeIn().siblings().fadeOut(),__commonToggleActive(s.eq(e)))})},3e3),s.click(function(e){clearInterval(a);var i=$(this).index();n.eq(i).fadeIn().siblings().fadeOut(),__commonToggleActive($(this))});var i=new ScaleImg,r=$("#scale-img"),d=!1;r.on("click",function(){$(this).toggleClass("active"),$(this).hasClass("active")?(i.initToolTips(),d=!0):(d=!1,$("#toolTipLayer").remove())});$(".select-item");for(var f=$(".section-newest-main").find("ul"),m=0;m<=f.length;m++)$(".atlas-newest"+m).flexImages({rowHeight:250,container:".img-item",truncate:!0});$(".list-waterfall-imgs").flexImages({rowHeight:300,container:".select-item",truncate:!0});$(".topic-type");$(".topic-type").on("click","li",function(){var e=$(this).index();__commonToggleActive([$(this),f.eq(e)])}),$(".list-waterfall-imgs").on("mouseenter",".select-item",function(){if($(this).find(".more-img ul").children("li").each(function(e,i){if(!$(i).find("img.lazy-hover").attr("src")){var a=$(i).find("img.lazy-hover").data("img");$(i).find("img").attr("src",a)}}),d){var e=$(this).find(".waterfall-img").attr("src").replace(/[ ]/g,"%20");i.toolTip("<img src="+e+">")}}).on("mouseleave",".select-item",function(){i.toolTip()});$("#collect-btn"),$(".collect-wra"),$("#col-number");$(".list-waterfall-imgs").on("click",".add",function(e){e.preventDefault(),e.stopPropagation(),$(this).addCollection.init({target:$(this),tragetDom:$("#collect-btn")})}),$(".close-nav-list").on("click",function(){$(this).hasClass("close")?($(".fl-aside").addClass("active"),$(this).removeClass("close").addClass("open")):($(".fl-aside").removeClass("active"),$(this).removeClass("open").addClass("close")),setTimeout(function(){$(window).resize()},400)});var h=$("#more-imgs"),p=$(".list-waterfall-imgs");h.on("click",function(){var l=$(this).attr("data-page")/1;$.ajax({url:"/index_pic",type:"POST",data:{page:l},success:function(e){if(200==e.code){for(var i="",a=0;a<e.photo_info.length;a++){var t="";e.photo_info[a].resemble&&$.each(e.photo_info[a].resemble,function(e,i){t+='<li><a href="'+i.url+'"><img src="'+i.thumb_small+'"></a></li>'}),i+='<li class="select-item" data-w="{{ width }}" data-h="{{ height }}" data-id="{{ imgId }}" data-point="{{ point }}"><div class="itemWra"><a href="{{ p_url }}" title="{{ title }}"><img src="{{ thumb }}" class="waterfall-img"><div class="add {{ active }}"><i class="icon-e-heart"></i><i class="icon-f-heart"></i><i class="icon-load"></i></div><div class="mask"><p class="title-id"><span class="title common_ovh">{{ title }}</span><span class="id fr">图片ID:{{ id }}</span></p></div></a><div class="more-img"><ul>{{ likeImgs }}</ul></div></div></li>'.replace("{{ width }}",0==e.photo_info[a].small_width?800:e.photo_info[a].small_width).replace("{{ height }}",0==e.photo_info[a].small_height?800:e.photo_info[a].small_height).replace("{{ point }}",e.photo_info[a].point).replace("{{ thumb }}",e.photo_info[a].thumb_small).replace(/{{ title }}/g,e.photo_info[a].title).replace("{{ imgId }}",e.photo_info[a].id).replace("{{ id }}",e.photo_info[a].id).replace("{{ p_url }}",e.photo_info[a].url).replace("{{ active }}",-1==$.inArray(e.photo_info[a].id+"",o)?"":"active").replace("{{ likeImgs }}",t)}$(i).appendTo(p),p.flexImages({rowHeight:300,container:".select-item",truncate:!0}),l++,h.attr("data-page",l)}else alert("已经最后一页")},error:function(e){alert(e)}})}),$(".parent-level").on("click","i",function(e){e.preventDefault(),e.stopPropagation();var i,l,a=$(this).parent().parent("li"),t=a.attr("data-id");$(this);a.hasClass("active")?a.removeClass("active").find("ul").children("li").remove():(i=t,l=a,$.post("/next_tag",{id:i},function(e){var a,t="";a='<li class="self-level" data-id="{{ id }}"><a href="{{ url }}"><i class="icon-open"></i><i class="icon-hide"></i>{{ name }}</a><ul></ul></li>',200==e.code&&($.each(e.next_menu,function(e,i){i.is_next?t+=a.replace("{{ id }}",i.id).replace("{{ name }}",i.keyword).replace("{{ url }}",i.url):t+=a.replace("{{ id }}",i.id).replace("{{ name }}",i.keyword).replace("{{ url }}",i.url).replace('<i class="icon-open"></i><i class="icon-hide"></i>',"")}),l.addClass("active").siblings(".parent-level").removeClass("active").find("ul").children("li").remove(),l.find("ul").append(t))}))})});