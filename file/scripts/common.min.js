function __commonGetCodeImg(s){$.ajax({url:"/tools/comment_code_img",type:"GET",success:function(e){s.attr("src",e.code_img_source)},error:function(e){return e}})}function tel_format(e){return!!/^1[34578]\d{9}$/.test(e)}function __commonHtmlParse(e){if("string"!=typeof e)return e;return e.replace(/[<>]/gi,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;"}})}$(function(){var e=$(".check-s"),s=$("#common_nav");e.click(function(e){$(this).hasClass("cancel")?($(this).removeClass("active").siblings("span").addClass("active").siblings(".ipt-wra").removeClass("active"),s.show()):($(this).removeClass("active").siblings().addClass("active"),s.hide())});var t=$("#check-style");t.on("click","img",function(){$(this).hasClass("day")?($("body").removeClass("day"),window.sessionStorage.isday=0):($("body").addClass("day"),window.sessionStorage.isday=1),$(this).removeClass("active").siblings().addClass("active")}),window.sessionStorage.isday&&(1==window.sessionStorage.isday?($("body").addClass("day"),t.find(".day").addClass("active").siblings().removeClass("active")):($("body").removeClass("day"),t.find(".night").addClass("active").siblings().removeClass("active")));var c=$("#logBox"),m=$("#login-mask"),i=!1;m.empty(),m.append('<div class="center-box" id="centerBox"><div class="login-wra" id="login-wra"><div class="login-reg" id="login-reg"><span class="login active">登录</span><span class="reg">注册</span></div><form id="login-form" class="login-form"><fieldset><input type="text" id="username" placeholder="账号/手机号"><p class="error-text">用户名不合法，请重新输入</p></fieldset><fieldset><input type="text" placeholder="验证码" class="code-ipt" maxlength="4" data-session-name="captcha-string" id="login_code_ipt"><img src="" alt="" class="code-img" id="login_img_code"><p class="error-text">验证码格式不正确</p></fieldset><fieldset><input type="password" id="password" placeholder="密码"><p class="error-text">密码不合法，请重新输入</p></fieldset><div class="rem-for"><input type="radio" id="inputRadio"><span>30天自动登录</span><span class="fr forgit-pw" id="forgit-pw">忘记密码？</span></div><button class="login-btn">登录</button><p class="error-text">对不起，用户名或密码错误。请重试。</p></form><div class="tp-login" id="tp-login"><p><span class="txt">第三方登录</span></p><div class="qq-wr"><span class="qq-icon icon-qq"></span><p>QQ登录</p></div><div class="wx-wr"><span class="wechat-icon icon-wechat"></span><p>微信登录</p></div></div><div class="tp-reg" id="tp-reg"><div class="qq-reg"><span class="qq-icon icon-qq"></span>QQ 注册</div><div class="wechat-reg"><span class="wechat-icon icon-wechat"></span>微信注册</div><div class="tel-reg" id="tel-reg"><span class="mobile-icon icon-tel"></span>手机注册</div><p class="tip-tel">手机首次注册送积分！</p></div><div class="reg-form" id="reg-bolie"><fieldset><input type="text" placeholder="手机号" id="reg_tel_num" maxlength="11"></fieldset><fieldset><input type="text" placeholder="验证码" class="code-ipt" maxlength="4" data-session-name="captcha-string"><img src="" alt="" class="code-img" id="reg_img_code"></fieldset><fieldset><input type="text" placeholder="短信验证码" maxlength="6" id="reg_note"><button class="send-code" id="send_reg_code">发送验证码</button></fieldset><fieldset><input type="password" placeholder="密码" maxlength="20" minlength="6" id="reg_pw"></fieldset><fieldset><input type="password" placeholder="重复密码" maxlength="20" minlength="6" id="reg_spw"></fieldset><p class="reg_tip"></p><button class="reg-tel-in">注册</button></div></div><div class="bcakPassWord" id="backPW"><p class="back-title">找回密码</p><div class="backPW-step-f"><fieldset><p class="">手机号</p><input type="text" id="pw_tel" maxlength="11"></fieldset><fieldset><p>验证码</p><input type="text" class="code-ipt" maxlength="4" data-session-name="captcha-string"><img src="" class="code-img" id="forgit_pw_img_code" alt=""></fieldset><fieldset><p>短信验证码</p><input type="text" maxlength="6" class="note"><button class="send-code" id="send_code_pw">发送验证码</button></fieldset><p class="back-pw-tip"></p><button class="step-btn" id="step-next">下一步</button></div><div class="backPW-step-t"><fieldset><p>输入密码</p><input type="password" id="f_pw"></fieldset><fieldset><p>确认密码</p><input type="password" id="s_pw"></fieldset><p class="sure-pw-tip"></p><button class="step-btn" id="surePW">确认更改</button></div></div><div class="success-tip" id="succ-tips"><div class="t-round"><i class="icon-marked"></i></div><p class="text-tip">密码修改成功！</p><p class="back-login" id="back-login"><i class="icon-download2"></i>返回登录界面</p></div><div class="close-btn icon-del" id="closeBtn"></div></div>');var a=$("#inputRadio");if(0<c.length){c.click(function(e){switch($(e.target).attr("id")){case"login-btn":A("login");break;case"reg-btn":A("reg")}}),m.click(function(e){$(this).hide()}),$("#centerBox").click(function(e){e.stopPropagation()}),$("#login-reg").click(function(e){var s=$(e.target);s.is(".login")?A("login"):s.is(".reg")&&A("reg")}),$("#closeBtn").click(function(){m.hide()}),a.click(function(){i=!i,console.log(i),$(this).prop("checked",i)}),$(".login-btn","#login-form").click(function(e){e.preventDefault();var s=$(this).parents("#login-form").find("input"),t=s.eq(0).val(),i=s.eq(2).val(),a=s.eq(3).prop("checked")?1:0,o=$(this).parents("#login-form").find(".error-text");if(t.length<2||16<t.length)o.eq(0).show();else if(o.eq(0).hide(),i.length<6||16<i.length)o.eq(2).show();else{o.eq(2).hide();var n=$("#login_code_ipt").attr("data-session-name"),c=new Object;c[n]=$("#login_code_ipt").val(),c.username=t,c.password=i,c.remember=a,""!=$("#login_code_ipt").val()&&4==$("#login_code_ipt").val().length?$.ajax({url:"/login_go",type:"POST",data:c,dataType:"json",success:function(e){if(e.member_info){e.member_info;window.location.reload()}else o.eq(3).show().text(e.msg)}}):o.eq(1).show()}}),$("#login_img_code").click(function(){__commonGetCodeImg($(this))}),$("#tp-login").add("#tp-reg").click(function(e){var s=$(e.target);s.is(".qq-reg")||s.closest("div").is(".qq-wr")?O("/qqcode"):(s.is(".wechat-reg")||s.closest("div").is(".wx-wr"))&&O("/wxcode")});var o,n,l=$("#forgit-pw"),r=$("#step-next"),d=$("#surePW"),p=$("#back-login"),g=$("#tel-reg"),v=$("#send_code_pw"),h=$("#forgit_pw_img_code"),f=$(".back-pw-tip"),w=!1;l.click(function(){A("forgitPwF"),__commonGetCodeImg(h)}),h.click(function(){__commonGetCodeImg($(this))}),v.click(function(){var e=$(".backPW-step-f .code-ipt").val();if(n=$("#pw_tel").val(),!w){var s=$(".backPW-step-f .code-ipt").attr("data-session-name");if(tel_format(n)&&""!=n)if(""!=e&&4==e.length){var t=new Object;t[s]=e,t.phone=n,$.ajax({url:"/password_retrieval",data:t,type:"POST",success:function(e){200==e.code?(f.text(e.msg).show().addClass("green"),w=!0,o=e.time_phone,P(v),__commonGetCodeImg(h)):(__commonGetCodeImg(h),f.text(e.msg).show().removeClass("green"))}})}else f.text("图形验证码格式错误").show().removeClass("green");else f.text("手机号格式错误").show().removeClass("green")}}),r.click(function(){var e=$(".backPW-step-f .note").val();""!=e?/^[0-9]+.?[0-9]*$/.test(e)&&6==e.length?$.ajax({url:"/password_code",type:"POST",data:{verification_code:e,time_phone:o},success:function(e){200==e.code?($("#pw_tel").val(""),$(".backPW-step-f .code-ipt").val(""),$(".backPW-step-f .note").val(""),A("forgitPwS")):f.text(e.msg).show().removeClass("green")}}):f.text("请输入正确的验证码格式").show().removeClass("green"):f.text("请获取验证码").show().removeClass("green")}),d.click(function(){var s=$(".backPW-step-t .sure-pw-tip"),e=$("#f_pw").val(),t=$("#s_pw").val();""!=e?e.length<6||20<e.length?s.text("密码长度为6-20个").show().removeClass("green"):e===t?$.ajax({url:"/edit_password",type:"POST",data:{phone:n,password:t},success:function(e){200==e.code?A("sucTip"):s.text(e.msg).show().removeClass("green")}}):s.text("两次输入密码不一致，请重新输入").show().removeClass("green"):s.text("密码不能为空").show().removeClass("green")}),p.click(function(){A("login")});var u=$("#reg-bolie"),_=$("#reg_img_code"),b=$("#reg_tel_num"),x=u.find(".code-ipt"),k=$("#send_reg_code"),C=$("#reg_note"),y=$("#reg_pw"),q=$("#reg_spw");function P(e){var s,t=60;s=setInterval(function(){e.text("重新发送("+t--+")").addClass("forbid"),w||(clearInterval(s),e.text("发送验证码").removeClass("forbid")),t<0&&(clearInterval(s),e.text("重新发送").removeClass("forbid"),w=!1)},1e3)}$reg_tel_in=$(".reg-tel-in"),g.click(function(){A("telReg"),__commonGetCodeImg(_)}),_.click(function(){__commonGetCodeImg($(this))}),k.click(function(){var e=x.val();if(n=b.val(),f=$(".reg_tip"),!w){var s=x.attr("data-session-name");if(tel_format(n)&&""!=n)if(""!=e&&4==e.length){var t=new Object;t[s]=e,t.phone=n,$.ajax({url:"/phone_register",data:t,type:"POST",success:function(e){200==e.code?(f.text(e.msg).show().addClass("green"),w=!0,o=e.time_phone,P(k),__commonGetCodeImg(_)):(__commonGetCodeImg(_),f.text(e.msg).show().removeClass("green"))}})}else f.text("图形验证码格式错误").show();else f.text("手机号格式错误").show()}}),$reg_tel_in.click(function(){var e=y.val(),s=q.val(),t=C.val(),i=$(".reg_tip");""!=t?/^[0-9]+.?[0-9]*$/.test(t)&&6==t.length?""!=e?e.length<6||20<e.length?i.text("密码长度为6-20个").show().removeClass("green"):e===s?$.ajax({url:"/register",type:"POST",data:{verification_code:t,time_phone:o,phone:n,password:s},success:function(e){200==e.code?(i.text(e.msg).show().addClass("green"),window.location.reload()):i.text(e.msg).show().removeClass("green")}}):i.text("两次输入密码不一致，请重新输入").show().removeClass("green"):i.text("密码不能为空").show().removeClass("green"):i.text("请输入正确的验证码格式").show().removeClass("green"):i.text("请获取验证码").show().removeClass("green")});var T=0;window.sessionStorage.hasTip&&(T=window.sessionStorage.hasTip);var S=$("#down-name"),I=!1;$.ajax({url:"/user_management_top",type:"POST",success:function(e){if(200==e.code){if("object"==typeof e.data&&function(e){if(0<c.length){var s,t=e.headimg||"/assets/images/avatarImg-1.jpg",i=e.point||0,a=e.msg_count||e.message||0,o=1==e.vip?" vip":"",n=e.nickname;e.prize_info;s=W.replace("{{ src }}",t).replace("{{ nickname }}",n).replace("{{ vipStatus }}",o).replace("{{ message }}",a).replace("{{ points }}",i),$("#logged-in").empty().append(s)}}(e.data),window.userLoggedIn=!0,window.publicIsSign=e.data.is_sign,$("#no-login").hide(),$("#logged-in").show(),$("#userCenterBar").show(),1===e.data.vip&&$("#sidebar_QQ").addClass("qq-orange"),0==e.data.is_mobile_checked&&0==T&&($("body").append('<div class="p-mask"><div class="prompt-box-tel" id="prompt_box"><span class="cancel-tip" id="prompt_cancel">X</span><p class="desc">账号绑定手机号码让账号更安全</p><p class="award">首次绑定手机号码可获得30积分<span class="p-tip">积分可用于下载软件</span></p><a href="/mac/pm/#/uc-tel">立即绑定</a></div></div>'),$(".p-mask").show(),$("#prompt_cancel").on("click",function(){$(".p-mask").hide()}),window.sessionStorage.hasTip=1),0<e.data.msg_count){var s='<a href="/mac/pm#wraitem-msgs" class="new-info-num" target="_self">'+e.data.msg_count+"</a>";$("#logged-in").append(s),$("body").append('<audio id="myaudio" src="/assets/audio/tip.mp3" controls="controls" hidden="true"></audio>');var t=document.getElementById("myaudio");0==T&&(t.play(),window.sessionStorage.hasTip=1)}}else $("#userCenterBar").hide(),I=!1,$(".mac-repeat").hide();""==e?(I=!1,$(".mac-repeat").hide()):(I=!0,e.data.vip?isVip=!0:isVip=!1),vipLogin=!!I&&!!isVip,vipLogin?S.text("会员下载"):S.text("立即下载")},error:function(e){}});var j=!1;$("#logged-in").click(function(e){if($(e.target).closest("#logOutBtn").is("#logOutBtn")){if(j)return;j=!0,$.ajax({url:"/login_out",type:"GET",success:function(e){200==e.code?($("#logged-in").hide(),$("#no-login").show(),window.location.reload(),window.sessionStorage.hasTip=0):(j=!1,alert("登出失败，请重试"))},error:function(){j=!1,alert("登出失败，请重试")}})}})}var G,W='<img src="{{ src }}" class="avatar-img-hook"><span class="vip-tag{{ vipStatus }}">VIP</span><span class="points">{{ points }}积分</span><i class="hover-arrow"></i><div class="hover-show"><p class="nickname common_ovh">{{ nickname }}</p><div class="pm-center"><a href="/mac/pm#wraitem-info" class="pm-item"><em>个人信息</em></a><a href="/mac/pm#wraitem-col" class="pm-item"><em>我的收藏</em></a><a href="/mac/pm#wraitem-down" class="pm-item"><em>我的下载</em></a><a href="/mac/pm#wraitem-history" class="pm-item"><em>浏览足迹</em></a><a href="/mac/pm#wraitem-recharge" class="pm-item"><em>充值记录</em></a><a href="/mac/pm#wraitem-consume" class="pm-item"><em>消费记录</em></a><a href="/mac/pm#wraitem-coupon" class="pm-item"><em>我的优惠券</em></a><a href="/mac/pm#wraitem-msgs" class="pm-item"><em>消息中心</em></a><a href="javascript:;" class="pm-item" id="logOutBtn"><em>退出</em></a></div></div>';function O(e){G&&G.close();var s=$(window).width(),t=($(window).height()-500)/2,i=(s-750)/2;G=window.open(e,"第三方安全登录","width=750, height=500, top="+t+", left="+i),setInterval(function(){document.cookie.match(/(qq_refersh_time=1)|(wx_refersh_time=1)/gi)&&(G.close(),$("#login-mask").hide(),B("qq_refersh_time"),B("wx_refersh_time"),window.location.reload())},2e3)}function B(e){document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/",document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/mac"}function A(e){m.show();var s=$("#login-wra"),t=$("#login-form"),i=$("#tp-login"),a=$("#tp-reg"),o=($("#login-reg"),$("#login-reg .login")),n=$("#login-reg .reg"),c=$("#backPW"),l=c.find(".backPW-step-f"),r=c.find(".backPW-step-t"),d=$("#succ-tips"),p=$("#reg-bolie");switch(e){case"login":s.show(),c.removeClass("active"),d.removeClass("active"),p.removeClass("active"),__commonToggleActive(o),t.show(),i.show(),a.hide(),__commonGetCodeImg($("#login_img_code"));break;case"reg":s.show(),c.removeClass("active"),d.removeClass("active"),p.removeClass("active"),__commonToggleActive(n),t.hide(),i.hide(),a.show();break;case"forgitPwF":__commonToggleActive(c),s.hide(),l.show(),r.hide();break;case"forgitPwS":__commonToggleActive(c),s.hide(),l.hide(),r.show();break;case"sucTip":__commonToggleActive(d),c.removeClass("active");break;case"telReg":__commonToggleActive([p,n]),t.hide(),i.hide(),a.hide(),c.removeClass("active");break;default:throw new Error("toggleMaskShow函数只接受两种字符串为参数，“login”或“reg”")}}});var _commonTypeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function __commonToggleActive(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"active";"object"===(void 0===e?"undefined":_commonTypeof(e))?$(e).each(function(e,s){$(s).addClass(t).siblings().removeClass(t)}):$(e).addClass(t).siblings().removeClass(t)}