$(function(){var p=$("#fix-top"),e=$("#content-nav"),f=e.offset().top,v=e.height(),i=$("#download_btn"),a=i.data("model"),t=i.data("title"),o=i.data("id"),n=$(".sec-item"),s=[];$(".fr-view img").each(function(){var e=$.Deferred();$(this).bind("load",function(){e.resolve()}).bind("error",function(){}),this.complete&&setTimeout(function(){e.resolve()},1e3),s.push(e)});var m=0<$(".fr-view .intro").length?$(".fr-view .intro"):$(".fr-view h3"),c=$(".fr-view img"),u=$("#content-nav-left"),h=$("#content-nav").offset().top,y=[],g=[];$.when.apply(null,s).done(function(){0<m.length&&m.each(function(e,i){var t=$(this).text().substr($(this).text().length-4),a=$(this).offset().top,o=$("<span>").text(t);u.append(o),y.push(Math.ceil(a-105))}),n.each(function(e,i){g.push(Math.ceil($(i).offset().top-100))}),0<c.length&&c.each(function(e,i){var t=$(this);t.on("load",function(){y=y.map(function(e){return e+t.height()}),0<e&&(g=g.map(function(e){return e+t.height()}))})}),u.click(function(e){var i=$(e.target).index();$("body, html").animate({scrollTop:y[i]},300)})});var _=$("#content-nav");_.on("click","li",function(e){$("body, html").animate({scrollTop:g[$(this).index()]},0)}),$(window).on("scroll",function(){var e,i=$(window).scrollTop();f<=i?(p.addClass("active"),p.next(".content").css("marginTop",v+42)):(p.removeClass("active"),p.next(".content").css("marginTop","20px"));for(var t=0;t<g.length;t++){var a=g[0],o=g[t],n=g[t+1];if(i<a){e=-1;break}if(!n||o<=i&&i<n){e=t;break}}if(0<=e?__commonToggleActive(_.children("li").eq(e)):_.children("li").removeClass("active"),h<i?u.show():u.hide(),0<m.length){var s,c=u.children();if(i<y[0])return void c.removeClass("active");for(var r=0;r<y.length;r++){var l=y[r],d=y[r+1];if(!d||l<=i&&i<d){s=r;break}}__commonToggleActive(c.eq(s))}else u.hide()});var r=$(".softwra"),l=$(".softwra").find("ul"),d=r.find(".show-wra"),x=l.children("li"),b=Math.ceil(x.length/7),k=d.width(),w=0,T=!1;l.width(b*k),r.click(function(e){var i=$(e.target);if(i.closest("div").is(".left-arr")){if(w<1||T)return;w--}if(i.closest("div").is(".right-arr")){if(b-1<=w||T)return;w++}T=!0,l.animate({marginLeft:-w*k},600,function(){T=!1})}),$(".relation-article").find("ul").on("mouseover","li",function(e){var i=$(e.target).closest("li");__commonToggleActive(i)});$(".error").on("click",function(){$("body").append('<div class="error-box"><p class="error-name">错误反馈</p><p class="error-title">请简要描述您遇到的错误，并留下联系方式，我们将尽快予以修正。</p><label><input type="radio" value="无法下载" name="info" class="ipt-radio" checked>无法下载</label><label><input type="radio" value="版本不对" name="info" class="ipt-radio">版本不对</label><label><input type="radio" value="版权投诉" name="info" class="ipt-radio">版权投诉</label><label><input type="radio" value="其他" name="info" class="ipt-radio">其他</label><label class="textarea"><textarea class="text-ipt" placeholder="请填写您的问题..."></textarea></label><div class="error-bottom"><input type="button" value="提交" class="ipt"><p class="error_text common_ovh"></p></div><span class="click-toggle">关闭</span></div>'),$(".click-toggle").on("click",function(){$(".error-box").remove()}),$(".error-box .ipt-radio").on("change",function(){var e=$('input:radio[name="info"]:checked').val();"其他"==e||"版权投诉"==e?($(".textarea").fadeIn(400),$("label").not(".textarea").animate({left:-100},400)):($(".textarea").fadeOut(400),$("label").not(".textarea").animate({left:0},400))}),$(".error-box .ipt").on("click",function(e){e.preventDefault();var i=$(".text-ipt").val(),t=$(".ipt-radio:checked").val();if(("其他"==t||"版权投诉"==t)&&!i)return $(".error_text").text("请描述您的问题！"),!1;$.ajax({url:"/report",type:"POST",data:{content:i,error_type:t,model_id:a},dataType:"json",success:function(e){200==e.code?($(".text-ipt").val(""),$(".error_text").text("提交成功，感谢您的反馈").css("color","green"),setTimeout(function(){$(".error-box").remove()},1e3)):$(".error_text").text(e.message)},error:function(e){console.log(e)}})})});var j=$(".up-down"),P=0;function A(i,t,e){"0"!=j.data("void")||P||$.ajax({url:"/tools/res_support",type:"POST",dataType:"json",data:{model_id:a,res_id:o,like:e},beforeSend:function(){P=1},success:function(e){200==e.code?(j.data("voted","1").unbind(),j.find(".sup em").text(i),j.find(".unsup em").text(t)):alert(e.msg)}})}goodNum=j.find(".sup em").text()/1,badNum=j.find(".unsup em").text()/1,j.click(function(e){var i=$(e.target).closest("span");i.is(".sup")?A(goodNum+1,badNum,1):i.is(".unsup")&&A(goodNum,badNum+1,0)});var C=$("#collect"),S={title:t,model_id:a,res_id:o,is_click:!1};function O(i){$.ajax({url:"/collection",type:"POST",data:i}).done(function(e){switch(e.message){case"已收藏":C.find("em").text("已收藏"),C.find("i").css("color","red");break;case"未收藏":C.find("em").text("点击收藏"),C.find("i").css("color","#fff");break;case"收藏成功":C.find("em").text("已收藏"),C.find("i").css("color","red");break;case"取消收藏":C.find("em").text("点击收藏"),C.find("i").css("color","#fff");break;case"用户未登陆":i.is_click?(C.find("em").text("点击收藏"),C.find("i").css("color","#fff"),$("#login-btn").click()):(C.find("em").text("点击收藏"),C.find("i").css("color","#fff"))}}).fail(function(e){console.log(e)})}C.on("click",function(){S.is_click=!0,O(S)}),O(S);var N,E=$("#download_btn, .down-btn"),q="",D='<div class="recharge" id="recharge"><div class="pay" id="recharge-pay"><div class="top"><p class="nickname">{{ tips }}</p></div><div class="cont"><div class="types-wrapper"><div class="types" id="payTypesHook"><span class="type-item active">VIP充值</span><span class="type-item">积分充值</span></div><div class="close" id="close">X</div><div class="money-choose"><ul class="item-warpper active clearfix" id="vip-hook"></ul><ul class="item-warpper clearfix" id="points-hook"></ul></div></div><div class="money-choose"><p class="hr"></p><p class="should-pay-num">支付方式</p><div class="types-wrapper"><div class="types pay-type-wrapper"><span class="pay-type type-item wechart active"><i class="icon-wechat"></i>微信支付</span><span class="pay-type type-item alipay"><i class="icon-alipay"></i>支付宝</span></div><div class="pay-scan active"><div class="ewm"><img src="/assets/images/loadcode.gif" alt="" id="preload-gif"><img src="" id="ewm"></div><div class="pay-num">应付金额 ： <span class="num">128</span>元</div><div class="intro-img"><img src="/assets/images/wechat-tutorial.png" class="active"></div></div><div class="pay-scan"><div class="ali-logo"><img src="/assets/images/ali-pay-logo.png" alt=""><span class="intro">支付宝扫码，安全、快捷</span><span class="pay-num">支付：<em class="p-text-orange pay-price">50</em>元</span></div><form action="/pay_ali" method="post" accept-charset="utf-8"><input name="id" value="9" type="hidden" id="ali_pay"><button class="btn-ali">立即订购</button></form></div></div></div></div></div></div>';function I(e){var d;G={vip:[],points:[]},$("#recharge").remove(),d=e,$.ajax({url:" /tools/member_point_info_AND_user_info",type:"POST",data:{point_type:d},dataType:"json",success:function(e){if(e.data&&"object"==typeof e.data){for(var i,a,o,n,t=e.data.member_point_info,s=(e.data.user_info,0),c=t.length;s<c;s++){if("object"!=typeof t[s])return;switch(t[s].point_type){case 1:G.points.push(t[s]);break;case 2:G.vip.push(t[s])}}i=G,n=o="",$.each(i.vip,function(e,i){var t=0===e?" active":"";a=H.replace("{ activeClass }",t).replace("{ id }",i.id).replace("{ shouldPay }",i.point_money).replace("{ pointType }","元/"+i.point_name.replace("会员套餐","")).replace("{ charge }",i.point_money),o+=a}),$.each(i.points,function(e,i){var t=0===e?" active":"";a=H.replace("{ activeClass }",t).replace("{ id }",i.id).replace("{ shouldPay }",i.point_money).replace("{ pointType }","积分").replace("{ charge }",i.point_num),n+=a}),$(o).add($(n)).click(function(e){$(this).index()}),$("#vip-hook").empty().append(o),$("#points-hook").empty().append(n);var r=1==d?"#points-hook":"#vip-hook",l=$(r).find(".active").data("id");X(l,V)}else alert("服务器错误，请刷新页面重试")}});var i,t=((i=$(D)).click(function(e){var i=$(e.target);if(i.is(".type-item")&&!i.is(".pay-type")){var t=i.index(),a=$(".item-warpper","#recharge").eq(t);__commonToggleActive([i,a]),a.find(".money-item.active").click()}else if(i.is(".money-item")||0<i.closest(".money-item").length){var o=(i=i.closest(".money-item")).attr("data-id");for(var n in $(".pay-type.active"),G)G[n].forEach(function(e){e.id==o&&$(".pay-price").text(e.point_money)});__commonToggleActive(i),X(o,1)}else if(i.is(".pay-type")){for(var n in t=i.index(),G)G[n].forEach(function(e){e.id==$(".item-warpper.active").find(".money-item.active").attr("data-id")&&$(".pay-price").text(e.point_money)});__commonToggleActive([i,$(".pay-scan").eq(t)])}else i.is(".btn-ali")&&$("#ali_pay").val($(".item-warpper.active").find(".money-item.active").attr("data-id"))}),i);$(".container").append(t),$(".nickname").text(q),$("#close").on("click",function(){$("#recharge").remove(),clearTimeout(N)}),__commonToggleActive($(1==e?"#points-hook":"#vip-hook")),$(1==e?"#points-hook":"#vip-hook").on("click",function(e){var i=$(e.target);if(i.hasClass("money-item")||0<i.closest(".money-item").length){if((i=i.closest(".money-item")).hasClass("active"))return;__commonToggleActive(i);var t=i.data("id");$(".pay-type-wrapper").find(".pay-type").filter(".active"),X(t,1)}})}function L(e){$.ajax({url:"/tools/download_by_point",type:"POST",dataType:"json",data:{model_id:a,res_id:o,code:e},success:function(e){if(200!=e.code)switch(q=e.msg,e.code){case"102":case"103":I(0),M()}else window.location.href=e.url}})}function M(){N&&clearTimeout(N),N=setInterval(function(){$.ajax({url:"/tools/get_pay_ok",type:"GET",success:function(e){200==e.code&&(alert("充值成功"),window.location.reload())}})},1e4)}E.on("click",function(){$.ajax({url:"/tools/download",type:"POST",data:{model_id:a,res_id:o}}).done(function(e){if(200==e.code)window.location.href=e.url;else switch(e.code){case 104:case 501:$("#login-btn").click();break;case 101:I(0),M();break;case 102:L(102);break;case 103:L(103)}}).fail(function(e){console.log(e)})});var G={vip:[],points:[]};var H='<li class="money-item { activeClass }" data-id="{ id }" ><span class="should-pay"><i>{ shouldPay }</i>元</span><span><i class="num">{ charge }</i>{ pointType }</span></li>';var V=1;function X(t,e){$.ajax({url:"/tools/pay_code",type:"POST",dataType:"json",data:{id:t,method:e},beforeSend:function(){$("#preload-gif").show()},success:function(e){if(200==e.code){for(var i in $("#ewm").attr("src",e.data),G){G[i].forEach(function(e){e.id==t&&$(".pay-num .num").text(e.point_money)})}$("#preload-gif").hide()}else alert("获取二维码失败，请刷新页面重试！")},error:function(e){alert("获取二维码失败，请刷新页面重试！")}})}var z=$(".fr-video");0!=z.length&&(z.each(function(e,i){if(0==$(i).find("iframe").length){$(i).append('<div class="video-img" id="video-img"><img src="/assets/images/video-pause.png"></div>');var t=$(i).find("video").get(0);t.addEventListener("play",function(){$(this).next(".video-img").find("img").attr("src","/assets/images/video-play.png").parent().delay(400).stop(!0,!0).hide(400)}),t.addEventListener("pause",function(){$(this).next(".video-img").find("img").attr("src","/assets/images/video-pause.png").parent().stop(!0,!0).show(400)})}}),z.on("click",".video-img",function(e){var i=$(this).parent().find("video").get(0);i.paused?i.play():i.pause()}),z.on("click","video",function(){z.find("video").get(0);this.paused||this.pause()}))});