"use strict";!function(d){d.fn.citySelect=function(i){if(!(this.length<1)){i=d.extend({url:"js/city.min.js",prov:null,city:null,dist:null,nodata:null,required:!0},i);var n,e=this,o=e.find(".prov"),c=e.find(".city"),s=e.find(".dist"),r=(i.prov,i.city,i.dist,i.required?"":"<option value=''>请选择</option>"),t=function(){var e=o.get(0).selectedIndex;if(i.required||e--,c.empty().attr("disabled",!0),s.empty().attr("disabled",!0),e<0||void 0===n.citylist[e].c)"none"==i.nodata?(c.css("display","none"),s.css("display","none")):"hidden"==i.nodata&&(c.css("visibility","hidden"),s.css("visibility","hidden"));else{var a=r;d.each(n.citylist[e].c,function(e,t){a+="<option value='"+t.n+"'>"+t.n+"</option>"}),c.html(a).attr("disabled",!1).css({display:"",visibility:""}),l()}},l=function(){var e=o.get(0).selectedIndex,t=c.get(0).selectedIndex;if(i.required||(e--,t--),s.empty().attr("disabled",!0),e<0||t<0||void 0===n.citylist[e].c[t].a)"none"==i.nodata?s.css("display","none"):"hidden"==i.nodata&&s.css("visibility","hidden");else{var a=r;d.each(n.citylist[e].c[t].a,function(e,t){a+="<option value='"+t.s+"'>"+t.s+"</option>"}),s.html(a).attr("disabled",!1).css({display:"",visibility:""})}},a=function(){var a=r;d.each(n.citylist,function(e,t){a+="<option value='"+t.p+"'>"+t.p+"</option>"}),o.html(a),setTimeout(function(){null!=i.prov&&(o.val(i.prov),t(),setTimeout(function(){null!=i.city&&(c.val(i.city),l(),setTimeout(function(){null!=i.dist&&s.val(i.dist)},1))},1))},1),o.bind("change",function(){t()}),c.bind("change",function(){l()})};"string"==typeof i.url?d.getJSON(i.url,function(e){n=e,a()}):(n=i.url,a())}}}(jQuery),$(function(){var t,s,e=$("#check-quset").find("label input"),a=$("#model-ids"),f=a.data("mac"),v=a.data("plugin"),m=a.data("material");e.on("change",function(e){__commonToggleActive($(e.target).closest("label"))});var i,n,r={email:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,url:/[a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi},g="/member_favorite",u="/del_favorite",h="/member_download",_="/del_member_download",y="/tools/footprint",b="/tools/footprint_del",o="/tools/pay_account",c="/pay_spend",l="/coupon_info",d="/member_notify",p="/error_report_list",k=!1,w=!1,x=!1,C=!1,j=!1,T=!1,A=!1,P=!1,O=!1,S=!1,F=!1,I=!1,M=!1;function q(l,e,d){var p,u;d==f?e==g?(p=$("#col-soft"))&&(u=$("#col-soft-pagination")):e==h?(p=$("#down-soft"))&&(u=$("#down-soft-pagination")):(p=$("#footer-soft"))&&(u=$("#footer-soft-pagination")):d==v?e==g?(p=$("#col-plugin"))&&(u=$("#col-plugin-pagination")):e==h?(p=$("#down-plugin"))&&(u=$("#down-plugin-pagination")):(p=$("#footer-plugin"))&&(u=$("#footer-plugin-pagination")):e==g?(p=$("#col-pic"))&&(u=$("#col-pic-pagination")):e==h?(p=$("#down-pic"))&&(u=$("#down-pic-pagination")):(p=$("#footer-pic"))&&(u=$("#footer-pic-pagination")),$.ajax({url:e,type:"POST",data:{page:l,model_id:d},dataType:"json",success:function(e){if(200==e.code&&"object"==typeof e.data){var t=e.data.data,a=e.data.total,i=Math.ceil(a/10),n=u.children().length;0<t.length?(o=t,c=p,s=d,r="",$.each(o,function(e,t){if("object"==typeof t)if(s==f||s==v){var a=D.replace("{{ imgSrc }}",t.thumb).replace("{{ title }}",t.title).replace("{{ version }}",t.version).replace("{{ time }}",Oe(1e3*t.add_time,"Y-m-d")).replace("{{ url }}",t.url);a=c.is("#footer-soft")?a.replace("{{ id }}",t.key):a.replace("{{ id }}",t.id),r+=a}else{var a=H.replace("{{ imgSrc }}",t.thumb).replace("{{ height }}",0==t.height?800:t.height).replace("{{ width }}",0==t.width?800:t.width).replace("{{ title }}",t.title).replace("{{ url }}",t.url);a=c.is("#footer-pic")?a.replace("{{ id }}",t.key):a.replace("{{ id }}",t.id),r+=a}c.empty().append(r),s==m&&c.flexImages({rowHeight:200,container:".img-item",truncate:!0})})):p.siblings(".no-data-show").show(),10<=a&&(l%10==0||i!=n)&&L(i,l,u),a<10&&u.remove(),u.attr("data-total",i)}else p.empty(),p.siblings(".no-data-show").show();var o,c,s,r},error:function(e){alert("服务器错误，请重试！")}})}$(window).on("load hashchange",function(){var i=window.location.href,n=i.lastIndexOf("#");(n<=0||n===i.length-1)&&(window.location.href="#wraitem-info",i=window.location.href,n=i.lastIndexOf("#")),function(){var e=i.substr(n+1),a=e.split("-"),t=$("."+a[1]).index();switch($(".nav-item").each(function(e,t){$(t).is("."+a[1])?$(t).addClass("active"):$(t).removeClass("active")}),__commonToggleActive($("."+a[0]).eq(t)),e){case"wraitem-info":break;case"wraitem-col":k||(k=!0,q(1,g,f));break;case"wraitem-down":C||(C=!0,q(1,h,f));break;case"wraitem-history":A||(A=!0,q(1,y,f));break;case"wraitem-recharge":S||(S=!0,$.ajax({url:o,type:"POST",success:function(e){200==e.code?Y(s=e.data):alert("获取数据失败，请刷新页面重试！")}}));break;case"wraitem-consume":F||(E(),F=!0);break;case"wraitem-coupon":I||(I=!0,B.page=1,B.coupon_status=-1,G(B));break;case"wraitem-msgs":M||(M=!0,V(),Q())}}(),$(".wraitem").each(function(e,n){$(n).find(".item-type").not(".coupon-type").on("click","span",function(e){var t=$(e.target).closest("span"),a=t.index(),i=$($(n).find(".item-con .item").eq(a));if(!t.hasClass("active")){switch(t.parent().parent().attr("class")){case"wraitem collection cm-content active":1==a&&(w||(q(1,g,v),w=!0)),2==a&&(x||(q(1,g,m),x=!0));break;case"wraitem donload-his cm-content active":1==a&&(j||(q(1,h,v),j=!0)),2==a&&(T||(q(1,h,m),T=!0));break;case"wraitem history cm-content active":1==a&&(P||(q(1,y,v),P=!0)),2==a&&(O||(q(1,y,m),O=!0))}__commonToggleActive([t,i])}})})}),$("#info-save-btn").click(function(e){e.preventDefault();var t=this;if(!$(this).hasClass("grey")){var a=$("#nickname-hook").val().trim(),i=$("#email-hook").val().trim(),n=($("#email-hook").attr("data-origin"),$("#sex-hook").val()),o=$("#job-hook").val(),c=$("#prov-hook").val(),s=$("#city-hook").val(),r=$("#address-hook").val();if(a){var l={nickname:a,email:i,sex:n="男"==n?1:"女"==n?2:0,job:o,province:c,city:s,address:r};$.ajax({url:"/edit_user_info",type:"POST",data:l,dataType:"json",success:function(e){200==e.code?(alert("保存修改成功"),$(t).addClass("grey")):alert(e.msg)}})}else alert("昵称不能为空")}}),$(".editCont").on("keyup change",function(e){if(e.stopPropagation(),13===e.keyCode&&0<$(this).val().length){var t=__commonHtmlParse($(this).val());$(this).hide().siblings("span").html(t).show()}else 13===e.keyCode&&0===$(this).val().length&&alert("内容不能为空");var a=$(e.target);a.siblings("span").text(a.val()),$("#info-save-btn").removeClass("grey")}),$("#extra-info").find("select").add($("#extra-info").find("input")).on("keyup change",function(e){$("#info-save-btn").removeClass("grey")}),i=$(".prov","#city").attr("value")?$(".prov","#city").attr("value"):"",n=$(".city","#city").attr("value")?$(".city","#city").attr("value"):"",$("#city").citySelect({url:"/assets/scripts/static/city.min.js",prov:i,city:n,required:!1}),$(".ajax-pagi").click(function(e){var t=$(e.target);if(!t.hasClass("disabled")&&!t.hasClass("active")){$(this).find(".num").length;var a=$(this).find(".num"),i=$(this).find(".active"),n=(a.index(i),Number(i.text())),o="#"+$(this)[0].id,c=$(this).attr("data-total");switch(t[0].className){case"prev":if(1==n)return;R(n-1,o);break;case"next":if(n==c)return;R(n+1,o);break;case"num":R(t.text(),o)}}}),$(".cm-content").each(function(e,t){$(t).click(function(e){var t=$(e.target);if(t.hasClass("del-col")){e.preventDefault();var a=t.closest("li"),i=a.attr("data-id"),n=a.parent().attr("id");confirm("是否确认移除？")&&function(e,t,a){var i,n,o,c,s,r=!1;switch(a){case"col-soft":n=g,i=u,o=$("#col-soft-pagination"),c=$("#"+a),s=f;break;case"col-plugin":n=g,i=u,o=$("#col-plugin-pagination"),c=$("#"+a),s=v;break;case"col-pic":n=g,i=u,o=$("#col-pic-pagination"),c=$("#"+a);break;case"down-soft":n=h,i=_,o=$("#down-soft-pagination"),c=$("#"+a),s=f;break;case"down-plugin":n=h,i=_,o=$("#down-plugin-pagination"),c=$("#"+a),s=v;break;case"down-pic":n=h,i=_,o=$("#down-pic-pagination"),c=$("#"+a),s=m;break;case"footer-soft":n=y,i=b,o=$("#footer-soft-pagination"),c=$("#"+a),s=f,r=!0;break;case"footer-plugin":n=y,i=b,o=$("#footer-plugin-pagination"),c=$("#"+a),s=v,r=!0;break;case"footer-pic":n=y,i=b,o=$("#footer-pic-pagination"),c=$("#"+a),s=m,r=!0}var l=o.find(".num.active").text()||1,d=c.children().length;l=0<d?l:l-1;var p={};r?(p.key=e,p.model_id=s):p.id=e;$.ajax({url:i,type:"POST",data:p,dataType:"json",success:function(e){if(200==e.code)return alert("删除成功"),0<o.length?q(l,n,s):$(t).remove(),!0;alert("删除失败，请重试。")}})}(i,a,n)}})});var D='<li data-id="{{ id }}"><a href="{{ url }}"><span class="del-col">X</span><span class="time">{{ time }}</span><div class="img"><img src="{{ imgSrc }}" alt=""></div><p class="title common_fff">{{ title }}</p><p class="vesrion common_999">{{ version }}</p><p class="down">立即下载</p></a></li>',H='<li class="img-item" data-h="{{ height }}" data-w="{{ width }}" data-id="{{ id }}"><a href="{{ url }}"><img src="{{ imgSrc }}" alt=""><div class="mask"><span class="del-col">删除</span><p class="common_ovh">{{ title }}</p></div></a></li>';$("#records-filters").click(function(e){var t,c;t=$("#records-filters").find("select"),c=[],t.each(function(e,t){var a,i,n=$(this).attr("filter-type"),o=$(this).val();switch(n){case"time":i="all"!=(a=o)?Date.now()/1e3-24*a*3600:0,s.forEach(function(e){e.add_time>=i&&c.push(e)});break;case"payment":!function(a){if("all"!==a){var i=[];c.forEach(function(e,t){e.pay_id==a&&i.push(e)}),c=i}}(o);break;case"type":!function(t){if("all"!==t){var a=[];c.forEach(function(e){e.type==t&&a.push(e)}),c=a}}(o)}}),Y(c)});var z="<tr><td>{{ content }}</td><td>{{ time }}</td><td>{{ type }}</td><td>{{ money }}元</td><td>{{ points }}</td></tr>";function Y(e,c){c=c||1;if(e.length){var s="";if($.each(e,function(e,t){if(10*(c-1)<=e&&e<10*c){var a=1==t.type?"购买积分":"升级VIP",i=1==t.pay_id?"微信":2==t.pay_id?"支付宝":"其它充值",n=t.contact_name,o=z;o=o.replace("{{ content }}",a).replace("{{ time }}",Oe(1e3*t.add_time,"Y-m-d")).replace("{{ type }}",i).replace("{{ money }}",t.money).replace("{{ points }}",n),s+=o}}),$("#records-table-hook").empty().append(s),10<e.length)L(Math.ceil(e.length/10),c,$("#recharge-pagination"));else $("#recharge-pagination").empty()}else{$("#records-table-hook").empty().append('<tr class="no-data-show-tb"><td colspan="5">没有数据</td></tr>')}}function E(n,e){n=n||1,e=$.extend({page:n},e);$.ajax({url:c,type:"POST",data:e,dataType:"json",success:function(e){if(200==e.code){if(e.message)return $("#consume-table-hook").empty().append('<tr><td colspan="6">'+e.message+"</td></tr>"),void $("#spent-pagination").empty();var t=e.data;if("object"==typeof t&&(i=t.info,c="",$.each(i,function(e,t){var a,i,n;switch(t.spend_type){case 3:a="VIP免费下载",i="原价 "+t.value+" 积分",n='下载软件<a href="{{ link }}" class="url">'+t.msg.substring(5,t.msg.length-1)+"</a> ";break;case 2:a="积分下载",i=t.value+" 积分",n='下载软件<a href="{{ link }}" class="url">'+t.msg.substring(5,t.msg.length-1)+"</a> ";break;case 4:a="积分抽奖",i=t.value+" 积分",n=t.msg}var o=Z.replace("{{ content }}",n).replace("{{ link }}",t.url).replace("{{ time }}",Oe(1e3*t.add_time,"Y-m-d")).replace("{{ type }}",a).replace("{{ points }}",i);c+=o}),$("#consume-table-hook").empty().append(c)),10<t.total){var a=Math.ceil(t.total/10);$("#spent-pagination").attr("data-total",a),L(a,n,$("#spent-pagination"))}else $("#spent-pagination").empty()}var i,c}})}$("#recharge-pagination").click(function(e){var t=$(e.target),a=$(this).find(".active").text();if(!t.hasClass("active")&&!t.hasClass("disabled"))switch(t[0].className){case"prev":i(+a-1);break;case"next":i(+a+1);break;case"num":i(t.text())}function i(e){Y(s,e)}}),$("#consume-filters").find("select").add($("#c-content-filter")).on("keyup change",function(e){$("#search-consume").removeClass("grey")}),$("#search-consume").click(function(){var e={add_time:$("#c-time-filter").val(),spend_type:$("#c-type-filter").val(),msg:$("#c-content-filter").val()};for(var t in e)e[t]=__commonHtmlParse(e[t]);E(1,e)});var Z='<tr><td colspan="3">{{ content }}</td><td>{{ time }}</td><td>{{ type }}</td><td>{{ points }}</td></tr>';var B=new Object;$("#check-coupon-type").on("click","span",function(e){e.preventDefault();var t=$(this).data("id");__commonToggleActive($(this)),B.page=1,B.coupon_status=t,G(B)});var N='<li class="{{ is_cover }}"><div class="fl"><div class="con"><p>满{{ min_price }}元可用</p><p class="time">{{ start_time }}-{{ end_time }}</p></div></div><div class="num"><span>￥<em>{{ price }}</em></span><div class="sign use">可使用</div><div class="sign unuse">已过期</div></div></li>';function G(n){$.ajax({url:l,type:"POST",data:n,success:function(e){if(200==e.code)if($("#coupon-wra").empty().append((a=e.coupon_info,i="",$.each(a,function(e,t){i+=N.replace("{{ is_cover }}",0==t.status?"":"active").replace("{{ price }}",t.coupon_point).replace("{{ min_price }}",t.min_consume).replace("{{ start_time }}",t.add_time).replace("{{ end_time }}",t.end_time)}),i)),12<e.total){var t=Math.ceil(e.total/12);$("#coupon-pagination").attr("data-total",t),L(t,n.page,$("#coupon-pagination"))}else $("#coupon-pagination").empty();var a,i},error:function(){}})}function V(s){s=s||1;$.ajax({url:d,type:"POST",data:{page:s},dataType:"json",success:function(e){if(200==e.code&&"object"==typeof e.data){var t=e.data.info,a=e.data.total,i=Math.ceil(a/10),n=$("#msgs-pagination").children().length;0<t.length&&(o=t,c="",$.each(o,function(e,t){if("object"==typeof t){var a=J.replace("{{ content }}",t.content).replace("{{ time }}",Oe(1e3*t.send_time));c+=a}$("#msg-hook").empty().append(c)})),10<=a&&(s%10==0||i!=n)&&L(i,s,$("#msgs-pagination")),a<10&&$("#msgs-pagination").remove(),0<$("#msgs-pagination").length&&$("#msgs-pagination").attr("data-total",i)}else $("#msg-hook").empty();var o,c},error:function(e){alert("服务器错误，请重试！")}})}var J="<tr><td><i></i>{{ content }}</td><td>{{ time }}</td></tr>";function Q(o){o=o||1;$.ajax({url:p,type:"POST",data:{page:o},dataType:"json",success:function(e){if(200==e.code){var t=e.data;if(t&&"object"==typeof t){i=t.info,n="",$.each(i,function(e,t){var a=X.replace("{{ url }}",t.url).replace("{{ url }}",t.url).replace("{{ type }}",t.error_type).replace("{{ content }}",t.content).replace("{{ time }}",Oe(1e3*t.add_time,"Y-m-d"));n+=a}),$("#reported-table").empty().append(n);var a=Math.ceil(t.total/10);1<a&&L(a,o,$("#reported-pagination"))&&$("#reported-pagination").attr("data-total",a)}}var i,n}})}var X='<tr><td><a href="{{ url }}">{{ url }}</a></td><td>{{ type }}</td><td>{{ content }}</td><td>{{ time }}</td></tr>';var K=!1;function L(e,t,a){if(1!=e){var i,n="";if(e<=10||10<e&&t<10)for(i=1;i<=Math.min(e,10);i++){n+='<a href="javascript:;" class="'+(i==t?"num active":"num")+'" value="'+i+'" target="_self">'+i+"</a>"}else{var o=10*Math.floor(t/10),c=Math.min(o+10,e);for(i=o;i<=c;i++){n+='<a href="javascript:;" class="'+(i==t?"num active":"num")+'" value="'+i+'" target="_self">'+i+"</a>"}}return $(a).empty().append('<a href="javascript:;" class="prev" target="_self">上一页</a>',n,'<a href="javascript:;" class="next" target="_self">下一页</a>'),!0}$(a).empty()}function R(e,t){var a=$(".num",t).filter(function(){return $(this).text()==e});switch(t){case"#col-soft-pagination":q(e,g,f);break;case"#col-plugin-pagination":q(e,g,v);break;case"#col-pic-pagination":q(e,g,m);break;case"#down-soft-pagination":q(e,h,f);break;case"#down-plugin-pagination":q(e,h,v);break;case"#down-pic-pagination":q(e,h,m);break;case"#footer-soft-pagination":q(e,y,f);break;case"#footer-plugin-pagination":q(e,y,v);break;case"#footer-pic-pagination":q(e,y,m);break;case"#coupon-pagination":B.page=e,G(B);break;case"#msgs-pagination":V(e);break;case"#reported-pagination":Q(e)}__commonToggleActive(a)}$("#report-btn").click(function(e){if(console.log(1),e.preventDefault(),K)alert("已提交报告，请勿重复提交");else{var a,t=$("input","#check-quset"),i=$("input","#report-url-hook"),n=$("textarea","#report-cont-hook"),o=$(".alert-text");if(t.each(function(e,t){$(t).prop("checked")&&(a=__commonHtmlParse($(t).attr("value")))}),"其他"!=a)var c=__commonHtmlParse($("input","#report-url-hook").val().trim());var s=__commonHtmlParse(n.val().trim());if(a)return"其他"==a||c?void("其他"==a||r.url.test(c)?s?(o.hide(),$.ajax({url:"/error_report",type:"POST",data:{error_type:a,url:c,content:s},dataType:"json",success:function(e){200==e.code?(alert("提交服务器成功"),K=!0,t.each(function(e,t){$(t).prop("checked",!1).parent("label").removeClass("active")}),i.val(""),n.val("")):o.text(e.msg).show()}})):o.text("请详细描述问题！").show():o.text("网址格式不符，请重新输入！").show()):(o.text("请输入页面的网址！").show(),void i.focus());o.text("请选择问题类型！").show()}});var U=$(".renew-close"),W=$("#renew-fee"),ee=$("#renew-wra"),te=$(".renew-type"),ae=$(".pay-scan"),ie=$(".coupon-wra"),ne=$(".btn-ali"),oe=new Object,ce=ie.find(".fr").text().replace("张可用 >","");function se(e){$.ajax({url:"/tools/pay_code",type:"POST",data:e,beforeSend:function(){$("#ewm").attr("src","/assets/images/loadcode.gif")},success:function(e){200==e.code&&$("#ewm").attr("src",e.data)},error:function(e){}})}oe.id=$("#vip-recharge").data("id"),oe.method=1,oe.coupon_relation_id=0,oe.renewals_status=1,W.click(function(e){ee.fadeIn(),se(oe),t=setInterval(function(){$.ajax({url:"/tools/get_pay_ok",type:"GET",success:function(e){200==e.code&&(alert("充值成功"),window.location.reload())}})},1e4)}),ie.click(function(e){if(0!=$(this).find(".fr").text().replace("张可用 >","")){if($(this).hasClass("active"))return $(e.target).closest(".useCoupon").is(".useCoupon")?(oe.coupon_relation_id=$(e.target).data("id"),$(".pay-num .num").text(($("#vip-recharge").find("i").text()/1-$(e.target).data("price")).toFixed(2)),$(".p-text-orange").text(($("#vip-recharge").find("i").text()/1-$(e.target).data("price")).toFixed(2)),$(".discounts").removeClass("active"),$(".coupon-wra").find(".fr").text("￥"+$(e.target).data("price")),se(oe),void e.stopPropagation()):$(e.target).closest(".discounts").is(".discounts")?void e.stopPropagation():$(e.target).is(".fr")?(e.stopPropagation(),void $(".discounts").toggleClass("active")):($(this).removeClass("active"),$(".discounts").removeClass("active"),oe.coupon_relation_id=0,$(".coupon-wra").find(".fr").html(ce+"张可用 &gt;"),$(".pay-num .num").text($("#vip-recharge").find("i").text()),$(".p-text-orange").text($("#vip-recharge").find("i").text()),void se(oe));$(this).addClass("active"),$(".discounts").addClass("active")}}),U.click(function(e){ee.fadeOut(),clearInterval(t)}),te.on("click","span",function(e){var t=$(e.target).closest("span");__commonToggleActive([t,ae.eq(t.index())])}),ne.click(function(e){$("#coupon_pay").val(oe.coupon_relation_id)});var re,le,de=$("#bind-tel"),pe=$(".tel-athu"),ue=$("#auth_code"),fe=$("#tel_num"),ve=$("#tel_pic"),me=$("#tel_code"),ge=$("#get_code"),$e=$(".tel_tips"),he=$("#submit_tel"),_e=!1,ye=$("#hasBindTel");de.click(function(e){pe.fadeIn(),Ae(ue)}),pe.find(".close-tel").click(function(e){pe.fadeOut()}),ve.on("focus click",function(){tel_format(fe.val())&&""!=fe.val()?$e.removeClass("active"):$e.text("手机号格式错误").addClass("active").css("color","#FF5A5A")}),ue.click(function(){Ae($(this))}),ge.click(function(){if(!_e){re=fe.val();var e=ve.val(),t=ve.attr("data-session-name");if(tel_format(re)&&""!=re)if(""!=e&&4==e.length){var a=new Object;a[t]=e,a.phone=re,$.ajax({url:"/phone_note",type:"POST",data:a,success:function(e){if(200==e.code)return $e.text(e.msg).addClass("active").css("color","green"),le=e.time_phone,_e=!0,Pe(ge),void Ae(ue);$e.text(e.msg).addClass("active").css("color","#FF5A5A"),Ae(ue)},error:function(e){return e}})}else $e.text("图形验证码格式错误").addClass("active").css("color","#FF5A5A");else $e.text("手机号格式错误").addClass("active").css("color","#FF5A5A")}}),he.click(function(){var e=me.val();/^[0-9]+.?[0-9]*$/.test(e)&&6==e.length?_e?$.ajax({url:"/note_verification",type:"POST",data:{verification_code:e,phone:re,time_phone:le},success:function(e){200==e.code?(alert("绑定成功"),$e.text("").removeClass("active"),pe.find(".toggle_view").removeClass("active"),pe.find(".toggle_view.hasBind").addClass("active"),ye.find("span").text(re)):$e.text(e.msg).css("color","#FF5A5A")},error:function(e){alert(e)}}):$e.text("请获取验证码").addClass("active").css("color","#FF5A5A"):$e.text("请输入正确验证码格式").addClass("active").css("color","#FF5A5A")}),$("#change_tel").click(function(){pe.fadeIn(),pe.find(".toggle_view").removeClass("active"),pe.find(".toggle_view.changeBind").addClass("active")});var be,ke=$("#get_change_code"),we=$("#past_tel_num"),xe=$(".tel_tips_past"),Ce=$("#old_code"),je=$("#submit_new_tel"),Te=$("#new_tel_num");function Ae(t){$.ajax({url:"/tools/comment_code_img",type:"GET",success:function(e){t.attr("src",e.code_img_source)},error:function(e){return e}})}function Pe(e){var t,a=60;t=setInterval(function(){e.text("重新发送（"+a--+"）").addClass("forbid"),_e||(clearInterval(t),e.text("发送验证码").removeClass("forbid")),a<0&&(clearInterval(t),e.text("重新发送").removeClass("forbid"),_e=!1)},1e3)}function Oe(e,t){var a=new Date(e),i=a.getFullYear(),n=a.getMonth()+1,o=a.getDate(),c=a.getHours(),s=a.getMinutes();return n=9<n?n:"0"+n,o=9<o?o:"0"+o,c=9<c?c:"0"+c,s=9<s?s:"0"+s,t?t.replace("Y",i).replace("m",n).replace("d",o).replace("h",c).replace("m",n):i+"-"+n+"-"+o+" "+c+":"+s}ke.click(function(){""!=(be=we.val())?tel_format(be)?$.ajax({url:"/chang_phone",type:"POST",data:{phone_old:be},success:function(e){200==e.code?(le=e.time_phone,xe.removeClass("ractive").addClass("gactive").text(e.msg),_e=!0,Pe(ke)):xe.removeClass("gactive").addClass("ractive").text(e.msg)}}):xe.addClass("ractive").text("原手机号码格式错误"):xe.addClass("ractive").text("原手机号码不能填入为空")}),je.click(function(){var t=Te.val(),e=Ce.val();""!=e?/^[0-9]+.?[0-9]*$/.test(e)&&6==e.length?""!=t?tel_format(t)?$.ajax({url:"/v_new_phone",type:"POST",data:{phone_new:t,verification_code:e,time_phone:le,phone_old:be},success:function(e){200==e.code?(alert("绑定成功"),xe.text("").removeClass("active"),pe.find(".toggle_view").removeClass("active"),pe.find(".toggle_view.hasBind").addClass("active"),ye.find("span").text(t),Te.val(""),we.val(""),Ce.val(""),xe.text("")):xe.text(e.msg).css("color","#FF5A5A")}}):xe.removeClass("gactive").addClass("ractive").text("新手机号码格式错误"):xe.removeClass("gactive").addClass("ractive").text("新手机号码不能填入为空"):xe.removeClass("gactive").addClass("ractive").text("请输入正确验证码格式"):xe.removeClass("gactive").addClass("ractive").text("请填入验证码")})});